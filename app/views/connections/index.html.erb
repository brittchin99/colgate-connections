<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
  <script>
    $(document).ready(function(){
    	$('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
    		localStorage.setItem('activeTab', $(e.target).attr('href'));
    	});
    	var activeTab = localStorage.getItem('activeTab');
    	if(activeTab){
    		$('#connectionsTab a[href="' + activeTab + '"]').tab('show');
    	}
    });
  </script>
</head>
<body>
  <div class="main pad-left">
    
    <ul class="nav nav-tabs" id="connectionsTab">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#connections">Connections</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#requests">Connection Requests
        
        <% if @friend_requests.length() != 0 %>
            <span class="notif"/>
        <% end %>
        </a>
      </li>
    </ul>
    
    <div class="tab-content">
      <div id="connections" class="tab-pane active">
        <h4>Suggested Connections</h4>
        <h3>My Connections</h3>
          <div class="search" style="display: table-cell;">
            <%= simple_form_for :filter_list, url: connections_path, :method => 'get', html: {:class => "form-inline"} do |f| %>
              <%= f.input :general_search_term, label: false, placeholder: "Search connections"%>
              <%= f.button :submit, "Search", class: "btn btn-light spacer"%>
            <% end %>
          </div>
          
          <div style="display: table-cell; padding: 5px;">
            <p>Sort By </p>
          </div>
          
          <div style="display: table-cell;">
            <%= simple_form_for :filter_list, url: connections_path, :method => 'get',  html: {:class => "form-inline"} do |f|%>
                <%= f.input :sort_by, label: false, collection: ["Name", "Date Connected: Latest", "Date Connected: Earliest"], selected: @sort_key %>
                <%= f.button :submit, "Sort", class: "btn btn-light spacer"%>
            <% end %>
          </div>
          <br/>
          
      <% if @connections.length() == 0 %>
        <p class="center">No connections found. <%= link_to "Add some?", profiles_path() %></p>
      <% else %>
        <table class="table">
        <tbody>
          <% @connections.each do |c| %>
            <tr><p>
              <td>
                Photo
              </td>
              <td>
                <%= link_to "#{c.friend.first_name} #{c.friend.last_name}", profile_path(c.friend.id) %>
              </td>
              <td>
                <div><%= link_to "Disconnect", connection_path(:id => current_account.id, :friend_id => c.friend.id), :method => :delete, :class => "btn btn-success" %></div>
              </td>
            </p></tr>
            <% end %>
          </tbody>
        </table>
        
      <% end %>
      </div>
      
      <div id="requests" class="tab-pane">
        <h3>Connection Requests</h3>
        <div>
          <% if @friend_requests.length() == 0 %>
            <p class="center">Too bad, no secret admirers!</p>
          <% else %>
            <table class="table">
            <tbody>
              <% @friend_requests.each do |c| %>
                <tr><p>
                  <td>
                    Photo
                  </td>
                  <td>
                    <h5><%= link_to "#{c.friend.first_name} #{c.friend.last_name}", profile_path(c.friend.id) %></h5>
                  </td>
                  <td>
                    <div><%= link_to "Accept", connections_path(:id => current_account, :friend_id => c.friend.id, :href => "#requests"), :method => :post, :class => "btn btn-primary" %></div>
                  </td>
                  <td>
                    <div><%= link_to "Delete", friend_request_path(:id => current_account, :friend_id => c.friend.id, :href => "#requests"), :method => :delete, :class => "btn btn-light" %></div>
                  </td>
                </p></tr>
                <% end %>
              </tbody>
            </table>  
          <% end %>
      </div>
    </div>
  </div>
  
</body>
  
</html>

